jQuery.fn.NLTreeMultiSelect=function(a){var b={tipText:a.tipText,selected_text:a.selected_text||" Options selected",dbClickTipText:a.selected_text||"",multiSelect_timer:null,select_state:false,nltree:null,param:null,selectDiv:null,titleDiv:null,contentDiv:null,iframeDiv:null,timerClick:null};var c={doView:{drawDivs:function(e){b.outerSelectDiv=$('<div id="multiTreeOuterSelect-'+e.id+'" class="multiTreeOuterSelect">');b.selectDiv=$('<div id="multiTreeSelect-'+e.id+'" class="multiTreeSelect">');b.titleDiv=$('<div id="multiTreeSelect-'+e.id+'-title" class="title">').html(d.strReplaceAll(b.tipText," ","&nbsp;"));if(a.height<20){a.height=20}b.contentDiv=$('<div id="multiTreeSelect-'+e.id+'-content" class="multiSelectContent collapsed" style="over-flow: scroll; text-align: left;">');b.iframeDiv=$('<div id="multiTreeSelect-'+e.id+'-iframe" class="multiSelectIframe collapsed" style="over-flow: hidden; text-align: left;">');b.selectDiv.append(b.titleDiv);jQuery(e.currentObj).before(b.outerSelectDiv);if($.browser.msie&&$.browser.version==6){jQuery(e.currentObj).before(b.iframeDiv)}b.outerSelectDiv.css("width",a.width);b.outerSelectDiv.css("position","relative");b.selectDiv.css("width",a.width);b.selectDiv.css("height",a.height);b.titleDiv.css("width",a.width-19);b.titleDiv.css("height",a.height);b.titleDiv.css("text-overflow","ellipsis");b.titleDiv.css("white-space","nowrap");b.titleDiv.css("overflow","hidden");b.contentDiv.css({width:b.outerSelectDiv.width()-2+"px",height:a.contentHeight+"px",overflow:"auto"});if($.browser.msie&&$.browser.version==6){b.iframeDiv.css({width:b.outerSelectDiv.width()-2+"px",height:a.contentHeight+"px",overflow:"hidden"})}if(a.bgClass){$(".multiSelectContent").addClass(a.bgClass)}jQuery(e.currentObj).remove("#"+e.id);jQuery(b.outerSelectDiv).append(b.selectDiv);jQuery(b.outerSelectDiv).append(b.contentDiv);$(window).resize(function(){b.selectDiv.css("width",a.width);b.selectDiv.css("height",a.height);b.titleDiv.css("width",b.selectDiv.width()-19);b.titleDiv.css("height",a.height);b.contentDiv.css({width:b.selectDiv.width()-2+"px",height:a.contentHeight+"px",overflow:"auto"});if($.browser.msie&&$.browser.version==6){b.iframeDiv.css({width:b.selectDiv.width()-2+"px",height:a.contentHeight+"px",overflow:"hidden"})}})},instanceNLTree:function(e){b.param=jQuery.extend({container_id:"multiTreeSelect-"+e+"-content"},a.nltree);b.nltree=new NLTree(b.param)}},doControl:{bindSelectDivEvent:function(){b.selectDiv.bind("click",d.close)},bindTitleDivEvent:function(){if(a.dblclickdoClearData){b.titleDiv.bind("click",function(f){clearTimeout(b.timer);b.timer=setTimeout(function(){d.close()},300);d.stopPropagation(f)}).bind("dblclick",function(){clearTimeout(b.timer);d.clearData()})}else{b.titleDiv.bind("click",d.close)}},doShowAndHideContentDivEvent:function(){jQuery([b.selectDiv.get(0),b.contentDiv.get(0)]).mouseout(function(){b.selectDiv.removeClass("hover");b.multiSelect_timer=setTimeout(function(){if(b.multiSelect_timer!=null){clearTimeout(b.multiSelect_timer);b.multiSelect_timer=null;if(b.select_state==true){$(document).bind("click",d.close)}else{if(a.isNullFreshText){if(d.getData().length==0){$(document).bind("click",function(f){d.bindDocumentClick(f)})}}}}},a.timeout)});jQuery([b.selectDiv.get(0),b.contentDiv.get(0)]).mouseover(function(f){b.selectDiv.addClass("hover");$(document).unbind("click",d.close);$(document).unbind("click",d.bindDocumentClick);if(b.multiSelect_timer==null){return}clearTimeout(b.multiSelect_timer);b.multiSelect_timer=null})},fireClickNode:function(g,f){if(a.clickdoClose){b.nltree.bind("click_node",function(i,h){d.close()})}},fireDblclickNode:function(g,f){if(a.dbclickdoClose){b.nltree.bind("dblclick_node",function(i,h){d.close()})}},bindNLTreeEvents:function(e){if(a.binds){if(a.binds.click_node){b.nltree.bind("click_node",function(g,f){a.binds.click_node({nltree:b.nltree,e:g,data:f})})}if(a.binds.dblclick_node){b.nltree.bind("dblclick_node",function(g,f){a.binds.dblclick_node({nltree:b.nltree,e:g,data:f})})}if(a.binds.open_node){b.nltree.bind("open_node",function(g,f){a.binds.open_node({nltree:b.nltree,e:g,data:f})})}}}}};var d={close:function(g){if(!a.dblclickdoClearData){d.stopPropagation(g)}b.select_state=b.select_state?false:true;if(b.select_state){b.contentDiv.removeClass("collapsed");b.contentDiv.addClass("expanded");if($.browser.msie&&$.browser.version==6){b.iframeDiv.removeClass("collapsed");b.iframeDiv.addClass("expanded");var f=b.contentDiv.width();var e=b.contentDiv.height();if(b.iframeDiv.children("iframe").length==0){b.iframeDiv.append("<iframe id='iframe_div' style='position: absolute; z-index: -1; width: "+f+"px; height: "+e+"px; top: 0;left: -1px; scrolling: no;background: #e9f3f8;filter:alpha(opacity=0);-moz-opacity:0;' frameborder='0' ></iframe>")}var h=b.contentDiv;b.contentDiv.bind("scroll",function(){e=h[0].scrollHeight;f=h[0].scrollWidth;b.iframeDiv.children("iframe").height(e);b.iframeDiv.children("iframe").width(f)})}if(a.clickCallFn){a.clickCallFn.call(this,{id:"multiTreeSelect-"+a.container_id+"-content"})}}else{b.contentDiv.addClass("collapsed");b.contentDiv.removeClass("expanded");b.iframeDiv.addClass("collapsed");b.iframeDiv.removeClass("expanded");d.setText()}$(document).unbind("click",d.close)},stopPropagation:function(f){if(f&&f.stopPropagation){f.stopPropagation()}else{window.event.cancelBubble=true}},clearData:function(){if(a.nltree.checkbox){b.nltree.uncheckAll()}else{b.nltree.unselectAll()}b.titleDiv.html(d.strReplaceAll(a.tipText," ","&nbsp;"));b.titleDiv.attr("title",a.tipText)},setText:function(g){if(g){b.titleDiv.html(d.strReplaceAll(g.text," ","&nbsp;"));b.titleDiv.attr("title",g.text)}else{var e=new Array();var f=b.nltree.getSelectedNodesData();if(f.length>0){$.each(f,function(j,h){if(a.onShowProperty){e.push(h[a.onShowProperty])}else{e.push(h.text)}});b.selected_text=e.join(a.connectStr);b.titleDiv.text(b.selected_text);b.titleDiv.attr("title",b.selected_text)}else{b.titleDiv.html(d.strReplaceAll(b.tipText," ","&nbsp;"));b.titleDiv.attr("title",b.tipText)}}},disabled:function(){b.selectDiv.attr("disabled","disabled");b.selectDiv.addClass("titleDiv_disabled");b.titleDiv.attr("disabled","disabled");if($.browser.mozilla||$.browser.safari||$.browser.opera){b.titleDiv.css("color","grey");b.titleDiv.unbind("click");b.selectDiv.unbind("click");b.titleDiv.unbind("dblclick")}if($.browser.msie&&$.browser.version==9){b.selectDiv.unbind("click",d.close)}},enabled:function(){b.selectDiv.removeAttr("disabled");b.selectDiv.removeClass("titleDiv_disabled");b.titleDiv.removeAttr("disabled");if($.browser.mozilla||$.browser.safari||$.browser.opera){b.titleDiv.css("color","rgb(0,0,0)");if(!b.titleDiv.data("events")||!b.titleDiv.data("events")["click"]){c.doControl.bindTitleDivEvent();b.selectDiv.bind("click",d.close)}}if($.browser.msie&&$.browser.version==9){b.selectDiv.bind("click",d.close)}},getData:function(f){var e=[];e=b.nltree.getSelectedNodesData();return e},bindDocumentClick:function(f){f=f||window.event;if(f.target.tagName.toLowerCase()=="html"){if(d.getData().length>0){d.setText()}else{d.setText({text:b.tipText})}}},strReplaceAll:function(g,f,e){return g.replace(new RegExp(f,"gm"),e)}};this.fns={disabled:d.disabled,enabled:d.enabled,getData:d.getData,closeSelect:d.close,setText:d.setText,getTreeObject:function(){return b.nltree}};return this.each(function(){var e=this;var f=$(this).attr("id");c.doView.drawDivs({id:f,currentObj:e});c.doView.instanceNLTree(f);c.doControl.bindSelectDivEvent();c.doControl.bindTitleDivEvent();if(a.disabled){d.disabled()}c.doControl.doShowAndHideContentDivEvent();c.doControl.bindNLTreeEvents()})};function NLTreeMultiSelect(b){b=$.extend({container_id:false,width:300,height:20,dbClickTipText:"",contentHeight:150,timeout:0,onShowProperty:"text",isNullFreshText:true,bgClass:false,dblclickdoClearData:true,tipText:"",disabled:false,connectStr:";",nltree:false,binds:false,clickCallFn:false},b);b.timeout=0;var a=$("#"+b.container_id).NLTreeMultiSelect(b);this.getValue=function(){return a.fns.getData()};this.disabled=function(){a.fns.disabled()};this.enabled=function(){a.fns.enabled()};this.closeSelect=function(){a.fns.closeSelect()};this.getTreeObject=function(){return a.fns.getTreeObject()};this.setText=function(c){a.fns.setText(c)}};
